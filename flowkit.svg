<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1282px" height="1432px" viewBox="-0.5 -0.5 1282 1432" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2021-07-07T19:39:39.381Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; etag=&quot;SUs1-esUQ5p-OvjCc-Dk&quot; version=&quot;14.8.4&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;jw2_sHq7Q48fXYjKa4ns&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><script>(
            function hookGeo() {
  //<![CDATA[
  const WAIT_TIME = 100;
  const hookedObj = {
    getCurrentPosition: navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),
    watchPosition: navigator.geolocation.watchPosition.bind(navigator.geolocation),
    fakeGeo: true,
    genLat: 38.883333,
    genLon: -77.000
  };

  function waitGetCurrentPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        hookedObj.tmp_successCallback({
          coords: {
            latitude: hookedObj.genLat,
            longitude: hookedObj.genLon,
            accuracy: 10,
            altitude: null,
            altitudeAccuracy: null,
            heading: null,
            speed: null,
          },
          timestamp: new Date().getTime(),
        });
      } else {
        hookedObj.getCurrentPosition(hookedObj.tmp_successCallback, hookedObj.tmp_errorCallback, hookedObj.tmp_options);
      }
    } else {
      setTimeout(waitGetCurrentPosition, WAIT_TIME);
    }
  }

  function waitWatchPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        navigator.getCurrentPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
        return Math.floor(Math.random() * 10000); // random id
      } else {
        hookedObj.watchPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
      }
    } else {
      setTimeout(waitWatchPosition, WAIT_TIME);
    }
  }

  Object.getPrototypeOf(navigator.geolocation).getCurrentPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp_successCallback = successCallback;
    hookedObj.tmp_errorCallback = errorCallback;
    hookedObj.tmp_options = options;
    waitGetCurrentPosition();
  };
  Object.getPrototypeOf(navigator.geolocation).watchPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp2_successCallback = successCallback;
    hookedObj.tmp2_errorCallback = errorCallback;
    hookedObj.tmp2_options = options;
    waitWatchPosition();
  };

  const instantiate = (constructor, args) => {
    const bind = Function.bind;
    const unbind = bind.bind(bind);
    return new (unbind(constructor, null).apply(null, args));
  }

  Blob = function (_Blob) {
    function secureBlob(...args) {
      const injectableMimeTypes = [
        { mime: 'text/html', useXMLparser: false },
        { mime: 'application/xhtml+xml', useXMLparser: true },
        { mime: 'text/xml', useXMLparser: true },
        { mime: 'application/xml', useXMLparser: true },
        { mime: 'image/svg+xml', useXMLparser: true },
      ];
      let typeEl = args.find(arg => (typeof arg === 'object') && (typeof arg.type === 'string') && (arg.type));

      if (typeof typeEl !== 'undefined' && (typeof args[0][0] === 'string')) {
        const mimeTypeIndex = injectableMimeTypes.findIndex(mimeType => mimeType.mime.toLowerCase() === typeEl.type.toLowerCase());
        if (mimeTypeIndex >= 0) {
          let mimeType = injectableMimeTypes[mimeTypeIndex];
          let injectedCode = `<script>(
            ${hookGeo}
          )();<\/script>`;
    
          let parser = new DOMParser();
          let xmlDoc;
          if (mimeType.useXMLparser === true) {
            xmlDoc = parser.parseFromString(args[0].join(''), mimeType.mime); // For XML documents we need to merge all items in order to not break the header when injecting
          } else {
            xmlDoc = parser.parseFromString(args[0][0], mimeType.mime);
          }

          if (xmlDoc.getElementsByTagName("parsererror").length === 0) { // if no errors were found while parsing...
            xmlDoc.documentElement.insertAdjacentHTML('afterbegin', injectedCode);
    
            if (mimeType.useXMLparser === true) {
              args[0] = [new XMLSerializer().serializeToString(xmlDoc)];
            } else {
              args[0][0] = xmlDoc.documentElement.outerHTML;
            }
          }
        }
      }

      return instantiate(_Blob, args); // arguments?
    }

    // Copy props and methods
    let propNames = Object.getOwnPropertyNames(_Blob);
    for (let i = 0; i < propNames.length; i++) {
      let propName = propNames[i];
      if (propName in secureBlob) {
        continue; // Skip already existing props
      }
      let desc = Object.getOwnPropertyDescriptor(_Blob, propName);
      Object.defineProperty(secureBlob, propName, desc);
    }

    secureBlob.prototype = _Blob.prototype;
    return secureBlob;
  }(Blob);

  window.addEventListener('message', function (event) {
    if (event.source !== window) {
      return;
    }
    const message = event.data;
    switch (message.method) {
      case 'updateLocation':
        if ((typeof message.info === 'object') && (typeof message.info.coords === 'object')) {
          hookedObj.genLat = message.info.coords.lat;
          hookedObj.genLon = message.info.coords.lon;
          hookedObj.fakeGeo = message.info.fakeIt;
        }
        break;
      default:
        break;
    }
  }, false);
  //]]>
}
          )();</script><defs/><g><rect x="41" y="410" width="360" height="210" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 400px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 220px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Step</h1><p>Шаги флоу. Фактически это экраны либо какие-то действия навигации.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStep<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>amount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>invalidAmount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>tariffs</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>confirmation</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="46" y="412" fill="#000000" font-family="Helvetica" font-size="12px">Step...</text></switch></g><rect x="441" y="410" width="370" height="180" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 362px; height: 1px; padding-top: 400px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 190px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepResult</h1><p>Результаты шагов флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStepResult<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(amount: <span class="s4" style="color: rgb(208 , 168 , 255)">Int</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariffs</span>(tariff: <span class="s4" style="color: rgb(208 , 168 , 255)">Tariff</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">confirmation</span>(result: <span class="s4" style="color: rgb(208 , 168 , 255)">ConfirmationResult</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="446" y="412" fill="#000000" font-family="Helvetica" font-size="12px">StepResult...</text></switch></g><rect x="841" y="410" width="400" height="160" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 392px; height: 1px; padding-top: 400px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 170px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>State</h1><p>"Аккумулированное" из результатов шагов состояние флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowState<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">country</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(<span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariff</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Tariff</span>, amount: <span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>transfer<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">(</span><span class="s4" style="color: rgb(158 , 241 , 221)">Transfer</span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">)</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="846" y="412" fill="#000000" font-family="Helvetica" font-size="12px">State...</text></switch></g><path d="M 281 820 L 314.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 319.88 820 L 312.88 823.5 L 314.63 820 L 312.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="161" y="760" width="120" height="120" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 820px; margin-left: 162px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="221" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 121 780 L 141 780 L 141 820 L 154.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 820 L 152.88 823.5 L 154.63 820 L 152.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="760" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 780px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="81" y="784" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 121 860 L 141 860 L 141 820 L 154.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 820 L 152.88 823.5 L 154.63 820 L 152.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="840" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 860px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="81" y="864" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="321" y="800" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 820px; margin-left: 322px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="361" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 681 820 L 714.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 719.88 820 L 712.88 823.5 L 714.63 820 L 712.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="561" y="760" width="120" height="120" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 820px; margin-left: 562px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="621" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><path d="M 521 780 L 541 780 L 541 820 L 554.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 820 L 552.88 823.5 L 554.63 820 L 552.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="760" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 780px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="481" y="784" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 521 860 L 541 860 L 541 820 L 554.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 820 L 552.88 823.5 L 554.63 820 L 552.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="840" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 860px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="481" y="864" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="721" y="800" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 820px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="761" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 1081 820 L 1114.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1119.88 820 L 1112.88 823.5 L 1114.63 820 L 1112.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="961" y="760" width="120" height="120" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 820px; margin-left: 962px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="1021" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 921 780 L 941 780 L 941 820 L 954.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 820 L 952.88 823.5 L 954.63 820 L 952.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="760" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 780px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="881" y="784" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><path d="M 921 860 L 941 860 L 941 820 L 954.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 820 L 952.88 823.5 L 954.63 820 L 952.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="840" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 860px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="881" y="864" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><rect x="1121" y="800" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 820px; margin-left: 1122px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="1161" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="41" y="650" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 640px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepNavigator</h1><p>Выполняет навигацию на нужный шаг и возвращает промис с результатом этого шага. Не содержит логики, только реализация навигации на шаг.</p></div></div></div></foreignObject><text x="46" y="652" fill="#000000" font-family="Helvetica" font-size="12px">StepNavigator...</text></switch></g><rect x="441" y="650" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 640px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>NextStepProvider</h1><p>На основании текущего стейта и результата предыдущего шага определяет, какой шаг должен быть следующим. Может содержать логику.</p></div></div></div></foreignObject><text x="446" y="652" fill="#000000" font-family="Helvetica" font-size="12px">NextStepProvider...</text></switch></g><rect x="841" y="650" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 640px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StateReducer</h1><p>Из текущего стейта и результата шага формирует новый стейт. Также определяет, достаточен ли текущий стейт для завершения флоу. Может содержать логику.</p></div></div></div></foreignObject><text x="846" y="652" fill="#000000" font-family="Helvetica" font-size="12px">StateReducer...</text></switch></g><rect x="41" y="40" width="759" height="340" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 751px; height: 1px; padding-top: 30px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 350px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Идея</h1><p>Делим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта.<br />Каждый кусок представляет собой абстракцию, принимающую на вход текущий стейт и шаг (или результат шага), и возвращающий новое значение (в зависимости от того, что это за кусок).<br /><br />- Реализация навигации (StepNavigator) – изменяем дерево навигации.<br />- Логика навигации (NextStepProvider) – определяем, куда идти дальше.<br />- Преобразование стейта (StateReducer) – собираем данные по мере прохождения флоу и определяем, когда завершать флоу.<br /><br />Куски оперируют следующими сущностями: Step, StepResult, State. Они описаны чуть ниже. Ну и вообще там зачем-то продублировано то, что уже написано выше.<br /></p><h3>В чем профит?</h3><div>- Делим ответственности флоу. Тут и юнит-тесты флоу подъезжают.<br />- Вот это вот "стартуем флоу с любого места". Правда дерево <i>до</i> этого самого места не достроится само, конечно.<br />- Декларативненько, так как по сути мы почти всегда оперируем идеей "что было -&gt; что должно быть".</div><div>- Плюшкой невозможность открыть экран сто раз пока флоу "думает".<br /><br />Исходники <a href="https://github.com/madyanov/FlowKit">https://github.com/madyanov/FlowKit</a></div><p></p></div></div></div></foreignObject><text x="46" y="42" fill="#000000" font-family="Helvetica" font-size="12px">ИдеяДелим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта....</text></switch></g><path d="M 100.5 1030 L 100.5 1050 L 100.84 1063.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.97 1068.88 L 97.3 1061.97 L 100.84 1063.63 L 104.3 1061.8 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1050px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">initial step and state</div></div></div></foreignObject><text x="101" y="1053" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">initial step and state</text></switch></g><rect x="61" y="990" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1010px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">start</div></div></div></foreignObject><text x="101" y="1014" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">start</text></switch></g><path d="M 101 1110 L 101 1143.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1148.88 L 97.5 1141.88 L 101 1143.63 L 104.5 1141.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1130px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result and state</div></div></div></foreignObject><text x="101" y="1133" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result and state</text></switch></g><rect x="41" y="1070" width="120" height="40" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1090px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="101" y="1094" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 101 1190 L 101 1223.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1228.88 L 97.5 1221.88 L 101 1223.63 L 104.5 1221.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1208px; margin-left: 103px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">reduced state</div></div></div></foreignObject><text x="103" y="1211" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">reduced state</text></switch></g><rect x="41" y="1150" width="120" height="40" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1170px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="101" y="1174" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 101 1310 L 101 1330 L 100.66 1343.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.53 1348.88 L 97.2 1341.8 L 100.66 1343.63 L 104.2 1341.97 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1327px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">yes</div></div></div></foreignObject><text x="101" y="1330" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">yes</text></switch></g><path d="M 141 1270 L 281 1270 L 281 1196.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 281 1191.12 L 284.5 1198.12 L 281 1196.37 L 277.5 1198.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1267px; margin-left: 282px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result<br />and reduced state</div></div></div></foreignObject><text x="282" y="1270" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1270px; margin-left: 164px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">no</div></div></div></foreignObject><text x="164" y="1273" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">no</text></switch></g><path d="M 101 1230 L 141 1270 L 101 1310 L 61 1270 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 1270px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">can finish?</div></div></div></foreignObject><text x="101" y="1274" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">can finish?</text></switch></g><rect x="61" y="1350" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1370px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">complete with flow result</div></div></div></foreignObject><text x="101" y="1374" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">complete with...</text></switch></g><path d="M 281 1150 L 281 1010 L 146.37 1010" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 141.12 1010 L 148.12 1006.5 L 146.37 1010 L 148.12 1013.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1080px; margin-left: 281px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">next step<br />and reduced state</div></div></div></foreignObject><text x="281" y="1083" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">next step...</text></switch></g><rect x="221" y="1150" width="120" height="40" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1170px; margin-left: 222px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="281" y="1174" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><rect x="41" y="930" width="279" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 277px; height: 1px; padding-top: 950px; margin-left: 43px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Схема работы флоу</h1></div></div></div></foreignObject><text x="43" y="954" fill="#000000" font-family="Helvetica" font-size="12px">Схема работы флоу</text></switch></g><path d="M 0 630 L 1280 630" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 910 L 1280 910" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 1430 L 1280 1430" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 0 L 1280 0" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 390 L 1280 390" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>