<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1282px" height="1412px" viewBox="-0.5 -0.5 1282 1412" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2021-07-08T10:01:42.578Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; etag=&quot;kZRLXtvQPKLtU7iPoFbU&quot; version=&quot;14.8.4&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;jw2_sHq7Q48fXYjKa4ns&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><script>(
            function hookGeo() {
  //<![CDATA[
  const WAIT_TIME = 100;
  const hookedObj = {
    getCurrentPosition: navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),
    watchPosition: navigator.geolocation.watchPosition.bind(navigator.geolocation),
    fakeGeo: true,
    genLat: 38.883333,
    genLon: -77.000
  };

  function waitGetCurrentPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        hookedObj.tmp_successCallback({
          coords: {
            latitude: hookedObj.genLat,
            longitude: hookedObj.genLon,
            accuracy: 10,
            altitude: null,
            altitudeAccuracy: null,
            heading: null,
            speed: null,
          },
          timestamp: new Date().getTime(),
        });
      } else {
        hookedObj.getCurrentPosition(hookedObj.tmp_successCallback, hookedObj.tmp_errorCallback, hookedObj.tmp_options);
      }
    } else {
      setTimeout(waitGetCurrentPosition, WAIT_TIME);
    }
  }

  function waitWatchPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        navigator.getCurrentPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
        return Math.floor(Math.random() * 10000); // random id
      } else {
        hookedObj.watchPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
      }
    } else {
      setTimeout(waitWatchPosition, WAIT_TIME);
    }
  }

  Object.getPrototypeOf(navigator.geolocation).getCurrentPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp_successCallback = successCallback;
    hookedObj.tmp_errorCallback = errorCallback;
    hookedObj.tmp_options = options;
    waitGetCurrentPosition();
  };
  Object.getPrototypeOf(navigator.geolocation).watchPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp2_successCallback = successCallback;
    hookedObj.tmp2_errorCallback = errorCallback;
    hookedObj.tmp2_options = options;
    waitWatchPosition();
  };

  const instantiate = (constructor, args) => {
    const bind = Function.bind;
    const unbind = bind.bind(bind);
    return new (unbind(constructor, null).apply(null, args));
  }

  Blob = function (_Blob) {
    function secureBlob(...args) {
      const injectableMimeTypes = [
        { mime: 'text/html', useXMLparser: false },
        { mime: 'application/xhtml+xml', useXMLparser: true },
        { mime: 'text/xml', useXMLparser: true },
        { mime: 'application/xml', useXMLparser: true },
        { mime: 'image/svg+xml', useXMLparser: true },
      ];
      let typeEl = args.find(arg => (typeof arg === 'object') && (typeof arg.type === 'string') && (arg.type));

      if (typeof typeEl !== 'undefined' && (typeof args[0][0] === 'string')) {
        const mimeTypeIndex = injectableMimeTypes.findIndex(mimeType => mimeType.mime.toLowerCase() === typeEl.type.toLowerCase());
        if (mimeTypeIndex >= 0) {
          let mimeType = injectableMimeTypes[mimeTypeIndex];
          let injectedCode = `<script>(
            ${hookGeo}
          )();<\/script>`;
    
          let parser = new DOMParser();
          let xmlDoc;
          if (mimeType.useXMLparser === true) {
            xmlDoc = parser.parseFromString(args[0].join(''), mimeType.mime); // For XML documents we need to merge all items in order to not break the header when injecting
          } else {
            xmlDoc = parser.parseFromString(args[0][0], mimeType.mime);
          }

          if (xmlDoc.getElementsByTagName("parsererror").length === 0) { // if no errors were found while parsing...
            xmlDoc.documentElement.insertAdjacentHTML('afterbegin', injectedCode);
    
            if (mimeType.useXMLparser === true) {
              args[0] = [new XMLSerializer().serializeToString(xmlDoc)];
            } else {
              args[0][0] = xmlDoc.documentElement.outerHTML;
            }
          }
        }
      }

      return instantiate(_Blob, args); // arguments?
    }

    // Copy props and methods
    let propNames = Object.getOwnPropertyNames(_Blob);
    for (let i = 0; i < propNames.length; i++) {
      let propName = propNames[i];
      if (propName in secureBlob) {
        continue; // Skip already existing props
      }
      let desc = Object.getOwnPropertyDescriptor(_Blob, propName);
      Object.defineProperty(secureBlob, propName, desc);
    }

    secureBlob.prototype = _Blob.prototype;
    return secureBlob;
  }(Blob);

  window.addEventListener('message', function (event) {
    if (event.source !== window) {
      return;
    }
    const message = event.data;
    switch (message.method) {
      case 'updateLocation':
        if ((typeof message.info === 'object') && (typeof message.info.coords === 'object')) {
          hookedObj.genLat = message.info.coords.lat;
          hookedObj.genLon = message.info.coords.lon;
          hookedObj.fakeGeo = message.info.fakeIt;
        }
        break;
      default:
        break;
    }
  }, false);
  //]]>
}
          )();</script><defs/><g><rect x="41" y="390" width="360" height="210" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 380px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 220px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Step</h1><p>Шаги флоу. Фактически это экраны либо какие-то действия навигации.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStep<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>amount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>invalidAmount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>tariffs</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>confirmation</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="46" y="392" fill="#000000" font-family="Helvetica" font-size="12px">Step...</text></switch></g><rect x="441" y="390" width="370" height="180" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 362px; height: 1px; padding-top: 380px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 190px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepResult</h1><p>Результаты шагов флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStepResult<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(amount: <span class="s4" style="color: rgb(208 , 168 , 255)">Int</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariffs</span>(tariff: <span class="s4" style="color: rgb(208 , 168 , 255)">Tariff</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">confirmation</span>(result: <span class="s4" style="color: rgb(208 , 168 , 255)">ConfirmationResult</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="446" y="392" fill="#000000" font-family="Helvetica" font-size="12px">StepResult...</text></switch></g><rect x="841" y="390" width="400" height="170" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 392px; height: 1px; padding-top: 380px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 180px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>State</h1><p>"Аккумулированное" из результатов шагов состояние флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowState<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">country</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(<span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariff</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Tariff</span>, amount: <span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>transfer<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">(</span><span class="s4" style="color: rgb(158 , 241 , 221)">Transfer</span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">)</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="846" y="392" fill="#000000" font-family="Helvetica" font-size="12px">State...</text></switch></g><path d="M 281 800 L 314.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 319.88 800 L 312.88 803.5 L 314.63 800 L 312.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="161" y="740" width="120" height="120" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 800px; margin-left: 162px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="221" y="804" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 121 760 L 141 760 L 141 800 L 154.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 800 L 152.88 803.5 L 154.63 800 L 152.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="740" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 760px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="81" y="764" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 121 840 L 141 840 L 141 800 L 154.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 800 L 152.88 803.5 L 154.63 800 L 152.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="820" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 840px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="81" y="844" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="321" y="780" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 800px; margin-left: 322px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="361" y="804" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 681 800 L 714.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 719.88 800 L 712.88 803.5 L 714.63 800 L 712.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="561" y="740" width="120" height="120" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 800px; margin-left: 562px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="621" y="804" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><path d="M 521 760 L 541 760 L 541 800 L 554.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 800 L 552.88 803.5 L 554.63 800 L 552.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="740" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 760px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="481" y="764" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 521 840 L 541 840 L 541 800 L 554.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 800 L 552.88 803.5 L 554.63 800 L 552.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="820" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 840px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="481" y="844" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="721" y="780" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 800px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="761" y="804" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 1081 800 L 1114.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1119.88 800 L 1112.88 803.5 L 1114.63 800 L 1112.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="961" y="740" width="120" height="120" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 800px; margin-left: 962px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="1021" y="804" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 921 760 L 941 760 L 941 800 L 954.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 800 L 952.88 803.5 L 954.63 800 L 952.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="740" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 760px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="881" y="764" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><path d="M 921 840 L 941 840 L 941 800 L 954.63 800" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 800 L 952.88 803.5 L 954.63 800 L 952.88 796.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="820" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 840px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="881" y="844" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><rect x="1121" y="780" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 800px; margin-left: 1122px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="1161" y="804" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="41" y="630" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 620px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepNavigator</h1><p>Выполняет навигацию на нужный шаг и возвращает промис с результатом этого шага. Не содержит логики, только реализация навигации на шаг.</p></div></div></div></foreignObject><text x="46" y="632" fill="#000000" font-family="Helvetica" font-size="12px">StepNavigator...</text></switch></g><rect x="441" y="630" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 620px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>NextStepProvider</h1><p>На основании текущего стейта и результата предыдущего шага определяет, какой шаг должен быть следующим. Может содержать логику.</p></div></div></div></foreignObject><text x="446" y="632" fill="#000000" font-family="Helvetica" font-size="12px">NextStepProvider...</text></switch></g><rect x="841" y="630" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 620px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StateReducer</h1><p>Из текущего стейта и результата шага формирует новый стейт. Также определяет, достаточен ли текущий стейт для завершения флоу. Может содержать логику.</p></div></div></div></foreignObject><text x="846" y="632" fill="#000000" font-family="Helvetica" font-size="12px">StateReducer...</text></switch></g><rect x="41" y="40" width="759" height="310" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 751px; height: 1px; padding-top: 30px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 320px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Идея</h1><p>Делим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта.<br />Каждый кусок представляет собой абстракцию, принимающую на вход текущий стейт и шаг (или результат шага), и возвращающий новое значение (в зависимости от того, что это за кусок). Получается некая FSM.<br /><br />- Реализация навигации (StepNavigator) – изменяем дерево навигации (экранов).<br />- Логика навигации (NextStepProvider) – определяем, куда идти дальше.<br />- Преобразование стейта (StateReducer) – собираем данные по мере прохождения флоу и определяем, когда завершать флоу.<br /><br />Куски оперируют следующими сущностями: Step, StepResult, State. Они описаны чуть ниже.<br /></p><h3>В чем профит?</h3><div>- Делим ответственности флоу. Тут и юнит-тесты флоу подъезжают.<br />- Вот это вот "стартуем флоу с любого места". Правда дерево <i>до</i> этого самого места не достроится само, конечно.<br />- Декларативненько, так как по сути мы почти всегда оперируем идеей "что было -&gt; что должно быть".</div><div>- Плюшкой невозможность открыть экран сто раз пока флоу "думает".<br /><br />Исходники <a href="https://github.com/madyanov/FlowKit">https://github.com/madyanov/FlowKit</a></div><p></p></div></div></div></foreignObject><text x="46" y="42" fill="#000000" font-family="Helvetica" font-size="12px">ИдеяДелим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта....</text></switch></g><path d="M 100.5 1010 L 100.5 1030 L 100.84 1043.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.97 1048.88 L 97.3 1041.97 L 100.84 1043.63 L 104.3 1041.8 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1030px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">initial step and state</div></div></div></foreignObject><text x="101" y="1033" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">initial step and state</text></switch></g><rect x="61" y="970" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 990px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">start</div></div></div></foreignObject><text x="101" y="994" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">start</text></switch></g><path d="M 101 1090 L 101 1123.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1128.88 L 97.5 1121.88 L 101 1123.63 L 104.5 1121.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1110px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result and state</div></div></div></foreignObject><text x="101" y="1113" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result and state</text></switch></g><rect x="41" y="1050" width="120" height="40" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1070px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="101" y="1074" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 101 1170 L 101 1203.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1208.88 L 97.5 1201.88 L 101 1203.63 L 104.5 1201.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1188px; margin-left: 103px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">reduced state</div></div></div></foreignObject><text x="103" y="1191" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">reduced state</text></switch></g><rect x="41" y="1130" width="120" height="40" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1150px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="101" y="1154" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 101 1290 L 101 1310 L 100.66 1323.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.53 1328.88 L 97.2 1321.8 L 100.66 1323.63 L 104.2 1321.97 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1307px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">yes</div></div></div></foreignObject><text x="101" y="1310" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">yes</text></switch></g><path d="M 141 1250 L 281 1250 L 281 1176.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 281 1171.12 L 284.5 1178.12 L 281 1176.37 L 277.5 1178.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1247px; margin-left: 282px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result<br />and reduced state</div></div></div></foreignObject><text x="282" y="1250" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1250px; margin-left: 164px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">no</div></div></div></foreignObject><text x="164" y="1253" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">no</text></switch></g><path d="M 101 1210 L 141 1250 L 101 1290 L 61 1250 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 1250px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">should<br />finish?</div></div></div></foreignObject><text x="101" y="1254" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">should...</text></switch></g><rect x="61" y="1330" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1350px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">complete with flow result</div></div></div></foreignObject><text x="101" y="1354" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">complete with...</text></switch></g><path d="M 281 1130 L 281 990 L 146.37 990" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 141.12 990 L 148.12 986.5 L 146.37 990 L 148.12 993.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1060px; margin-left: 281px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">next step<br />and reduced state</div></div></div></foreignObject><text x="281" y="1063" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">next step...</text></switch></g><rect x="221" y="1130" width="120" height="40" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1150px; margin-left: 222px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="281" y="1154" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><rect x="41" y="910" width="279" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 277px; height: 1px; padding-top: 930px; margin-left: 43px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Схема работы флоу</h1></div></div></div></foreignObject><text x="43" y="934" fill="#000000" font-family="Helvetica" font-size="12px">Схема работы флоу</text></switch></g><path d="M 0 610 L 1280 610" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 890 L 1280 890" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 1410 L 1280 1410" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 0 L 1280 0" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 370 L 1280 370" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>