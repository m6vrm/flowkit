<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1282px" height="1422px" viewBox="-0.5 -0.5 1282 1422" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2021-07-12T18:45:22.209Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; etag=&quot;iM9T8STjgzRuY2g64REi&quot; version=&quot;14.8.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;jw2_sHq7Q48fXYjKa4ns&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><script>(
            function hookGeo() {
  //<![CDATA[
  const WAIT_TIME = 100;
  const hookedObj = {
    getCurrentPosition: navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),
    watchPosition: navigator.geolocation.watchPosition.bind(navigator.geolocation),
    fakeGeo: true,
    genLat: 38.883333,
    genLon: -77.000
  };

  function waitGetCurrentPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        hookedObj.tmp_successCallback({
          coords: {
            latitude: hookedObj.genLat,
            longitude: hookedObj.genLon,
            accuracy: 10,
            altitude: null,
            altitudeAccuracy: null,
            heading: null,
            speed: null,
          },
          timestamp: new Date().getTime(),
        });
      } else {
        hookedObj.getCurrentPosition(hookedObj.tmp_successCallback, hookedObj.tmp_errorCallback, hookedObj.tmp_options);
      }
    } else {
      setTimeout(waitGetCurrentPosition, WAIT_TIME);
    }
  }

  function waitWatchPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        navigator.getCurrentPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
        return Math.floor(Math.random() * 10000); // random id
      } else {
        hookedObj.watchPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
      }
    } else {
      setTimeout(waitWatchPosition, WAIT_TIME);
    }
  }

  Object.getPrototypeOf(navigator.geolocation).getCurrentPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp_successCallback = successCallback;
    hookedObj.tmp_errorCallback = errorCallback;
    hookedObj.tmp_options = options;
    waitGetCurrentPosition();
  };
  Object.getPrototypeOf(navigator.geolocation).watchPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp2_successCallback = successCallback;
    hookedObj.tmp2_errorCallback = errorCallback;
    hookedObj.tmp2_options = options;
    waitWatchPosition();
  };

  const instantiate = (constructor, args) => {
    const bind = Function.bind;
    const unbind = bind.bind(bind);
    return new (unbind(constructor, null).apply(null, args));
  }

  Blob = function (_Blob) {
    function secureBlob(...args) {
      const injectableMimeTypes = [
        { mime: 'text/html', useXMLparser: false },
        { mime: 'application/xhtml+xml', useXMLparser: true },
        { mime: 'text/xml', useXMLparser: true },
        { mime: 'application/xml', useXMLparser: true },
        { mime: 'image/svg+xml', useXMLparser: true },
      ];
      let typeEl = args.find(arg => (typeof arg === 'object') && (typeof arg.type === 'string') && (arg.type));

      if (typeof typeEl !== 'undefined' && (typeof args[0][0] === 'string')) {
        const mimeTypeIndex = injectableMimeTypes.findIndex(mimeType => mimeType.mime.toLowerCase() === typeEl.type.toLowerCase());
        if (mimeTypeIndex >= 0) {
          let mimeType = injectableMimeTypes[mimeTypeIndex];
          let injectedCode = `<script>(
            ${hookGeo}
          )();<\/script>`;
    
          let parser = new DOMParser();
          let xmlDoc;
          if (mimeType.useXMLparser === true) {
            xmlDoc = parser.parseFromString(args[0].join(''), mimeType.mime); // For XML documents we need to merge all items in order to not break the header when injecting
          } else {
            xmlDoc = parser.parseFromString(args[0][0], mimeType.mime);
          }

          if (xmlDoc.getElementsByTagName("parsererror").length === 0) { // if no errors were found while parsing...
            xmlDoc.documentElement.insertAdjacentHTML('afterbegin', injectedCode);
    
            if (mimeType.useXMLparser === true) {
              args[0] = [new XMLSerializer().serializeToString(xmlDoc)];
            } else {
              args[0][0] = xmlDoc.documentElement.outerHTML;
            }
          }
        }
      }

      return instantiate(_Blob, args); // arguments?
    }

    // Copy props and methods
    let propNames = Object.getOwnPropertyNames(_Blob);
    for (let i = 0; i < propNames.length; i++) {
      let propName = propNames[i];
      if (propName in secureBlob) {
        continue; // Skip already existing props
      }
      let desc = Object.getOwnPropertyDescriptor(_Blob, propName);
      Object.defineProperty(secureBlob, propName, desc);
    }

    secureBlob.prototype = _Blob.prototype;
    return secureBlob;
  }(Blob);

  window.addEventListener('message', function (event) {
    if (event.source !== window) {
      return;
    }
    const message = event.data;
    switch (message.method) {
      case 'updateLocation':
        if ((typeof message.info === 'object') && (typeof message.info.coords === 'object')) {
          hookedObj.genLat = message.info.coords.lat;
          hookedObj.genLon = message.info.coords.lon;
          hookedObj.fakeGeo = message.info.fakeIt;
        }
        break;
      default:
        break;
    }
  }, false);
  //]]>
}
          )();</script><defs/><g><rect x="41" y="390" width="360" height="210" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 380px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 220px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Step</h1><p>Шаги флоу. Фактически это экраны либо какие-то действия навигации.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStep<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>amount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>invalidAmount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>tariffs</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>confirmation</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="46" y="392" fill="#000000" font-family="Helvetica" font-size="12px">Step...</text></switch></g><rect x="441" y="390" width="370" height="180" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 362px; height: 1px; padding-top: 380px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 190px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepResult</h1><p>Результаты шагов флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStepResult<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(amount: <span class="s4" style="color: rgb(208 , 168 , 255)">Int</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariffs</span>(tariff: <span class="s4" style="color: rgb(208 , 168 , 255)">Tariff</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">confirmation</span>(result: <span class="s4" style="color: rgb(208 , 168 , 255)">ConfirmationResult</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="446" y="392" fill="#000000" font-family="Helvetica" font-size="12px">StepResult...</text></switch></g><rect x="841" y="390" width="400" height="170" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 392px; height: 1px; padding-top: 380px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 180px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>State</h1><p>"Аккумулированное" из результатов шагов состояние флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowState<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">country</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(<span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariff</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Tariff</span>, amount: <span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>transfer<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">(</span><span class="s4" style="color: rgb(158 , 241 , 221)">Transfer</span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">)</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="846" y="392" fill="#000000" font-family="Helvetica" font-size="12px">State...</text></switch></g><path d="M 281 810 L 314.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 319.88 810 L 312.88 813.5 L 314.63 810 L 312.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="161" y="750" width="120" height="120" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 810px; margin-left: 162px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="221" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 121 770 L 141 770 L 141 810 L 154.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 810 L 152.88 813.5 L 154.63 810 L 152.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="750" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 770px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="81" y="774" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 121 850 L 141 850 L 141 810 L 154.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 810 L 152.88 813.5 L 154.63 810 L 152.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="830" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 850px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="81" y="854" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="321" y="790" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 810px; margin-left: 322px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="361" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 681 810 L 714.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 719.88 810 L 712.88 813.5 L 714.63 810 L 712.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="561" y="750" width="120" height="120" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 810px; margin-left: 562px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="621" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><path d="M 521 770 L 541 770 L 541 810 L 554.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 810 L 552.88 813.5 L 554.63 810 L 552.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="750" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 770px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="481" y="774" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 521 850 L 541 850 L 541 810 L 554.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 810 L 552.88 813.5 L 554.63 810 L 552.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="830" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 850px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="481" y="854" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="721" y="790" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 810px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="761" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 1081 810 L 1114.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1119.88 810 L 1112.88 813.5 L 1114.63 810 L 1112.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="961" y="750" width="120" height="120" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 810px; margin-left: 962px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="1021" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 921 770 L 941 770 L 941 810 L 954.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 810 L 952.88 813.5 L 954.63 810 L 952.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="750" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 770px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="881" y="774" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><path d="M 921 850 L 941 850 L 941 810 L 954.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 810 L 952.88 813.5 L 954.63 810 L 952.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="830" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 850px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="881" y="854" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><rect x="1121" y="790" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 810px; margin-left: 1122px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="1161" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="41" y="640" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 630px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepNavigator</h1><p>Выполняет навигацию на нужный шаг и возвращает промис с результатом этого шага. Не содержит логики, только реализация навигации на шаг.</p></div></div></div></foreignObject><text x="46" y="642" fill="#000000" font-family="Helvetica" font-size="12px">StepNavigator...</text></switch></g><rect x="441" y="640" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 630px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>NextStepProvider</h1><p>На основании текущего стейта и результата предыдущего шага определяет, какой шаг должен быть следующим. Может содержать логику.</p></div></div></div></foreignObject><text x="446" y="642" fill="#000000" font-family="Helvetica" font-size="12px">NextStepProvider...</text></switch></g><rect x="841" y="640" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 630px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StateReducer</h1><p>Из текущего стейта и результата шага формирует новый стейт. Также определяет, достаточен ли текущий стейт для завершения флоу. Может содержать логику.</p></div></div></div></foreignObject><text x="846" y="642" fill="#000000" font-family="Helvetica" font-size="12px">StateReducer...</text></switch></g><rect x="41" y="40" width="759" height="310" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 751px; height: 1px; padding-top: 30px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 320px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Идея</h1><p>Делим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта.<br />Каждый кусок представляет собой абстракцию, принимающую на вход текущий стейт и шаг (или результат шага), и возвращающий новое значение (в зависимости от того, что это за кусок). Получается некая FSM.<br /><br />- Реализация навигации (StepNavigator) – изменяем дерево навигации (экранов).<br />- Логика навигации (NextStepProvider) – определяем, куда идти дальше.<br />- Преобразование стейта (StateReducer) – собираем данные по мере прохождения флоу и определяем, когда завершать флоу.<br /><br />Куски оперируют следующими сущностями: Step, StepResult, State. Они описаны чуть ниже.<br /></p><h3>В чем профит?</h3><div>- Делим ответственности флоу. Тут и юнит-тесты флоу подъезжают.<br />- Вот это вот "стартуем флоу с любого места". Правда дерево <i>до</i> этого самого места не достроится само, конечно.<br />- Декларативненько, так как по сути мы почти всегда оперируем идеей "что было -&gt; что должно быть".</div><div>- Плюшкой невозможность открыть экран сто раз пока флоу "думает".<br /><br />Исходники <a href="https://github.com/madyanov/FlowKit">https://github.com/madyanov/FlowKit</a></div><p></p></div></div></div></foreignObject><text x="46" y="42" fill="#000000" font-family="Helvetica" font-size="12px">ИдеяДелим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта....</text></switch></g><path d="M 100.5 1020 L 100.5 1040 L 100.84 1053.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.97 1058.88 L 97.3 1051.97 L 100.84 1053.63 L 104.3 1051.8 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1040px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">initial step and state</div></div></div></foreignObject><text x="101" y="1043" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">initial step and state</text></switch></g><rect x="61" y="980" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1000px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">start</div></div></div></foreignObject><text x="101" y="1004" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">start</text></switch></g><path d="M 101 1100 L 101 1133.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1138.88 L 97.5 1131.88 L 101 1133.63 L 104.5 1131.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1120px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result and state</div></div></div></foreignObject><text x="101" y="1123" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result and state</text></switch></g><rect x="41" y="1060" width="120" height="40" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1080px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="101" y="1084" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 101 1180 L 101 1213.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1218.88 L 97.5 1211.88 L 101 1213.63 L 104.5 1211.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1198px; margin-left: 103px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">reduced state</div></div></div></foreignObject><text x="103" y="1201" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">reduced state</text></switch></g><rect x="41" y="1140" width="120" height="40" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1160px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="101" y="1164" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 101 1300 L 101 1320 L 100.66 1333.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.53 1338.88 L 97.2 1331.8 L 100.66 1333.63 L 104.2 1331.97 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1317px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">yes</div></div></div></foreignObject><text x="101" y="1320" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">yes</text></switch></g><path d="M 141 1260 L 280 1260 L 280 1186.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 280 1181.12 L 283.5 1188.12 L 280 1186.37 L 276.5 1188.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1257px; margin-left: 281px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result<br />and reduced state</div></div></div></foreignObject><text x="281" y="1260" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1260px; margin-left: 164px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">no</div></div></div></foreignObject><text x="164" y="1263" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">no</text></switch></g><path d="M 101 1220 L 141 1260 L 101 1300 L 61 1260 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 1260px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">should<br />finish?</div></div></div></foreignObject><text x="101" y="1264" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">should...</text></switch></g><rect x="61" y="1340" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1360px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">complete with flow result</div></div></div></foreignObject><text x="101" y="1364" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">complete with...</text></switch></g><path d="M 280 1140 L 280 1000 L 146.37 1000" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 141.12 1000 L 148.12 996.5 L 146.37 1000 L 148.12 1003.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1071px; margin-left: 281px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">next step<br />and reduced state</div></div></div></foreignObject><text x="281" y="1074" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">next step...</text></switch></g><rect x="220" y="1140" width="120" height="40" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1160px; margin-left: 221px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="280" y="1164" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><rect x="42" y="920" width="279" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 277px; height: 1px; padding-top: 940px; margin-left: 44px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Схема работы флоу</h1></div></div></div></foreignObject><text x="44" y="944" fill="#000000" font-family="Helvetica" font-size="12px">Схема работы флоу</text></switch></g><path d="M 0 620 L 1280 620" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 900 L 1280 900" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 1420 L 1280 1420" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 0 L 1280 0" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 370 L 1280 370" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><rect x="442" y="920" width="359" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 357px; height: 1px; padding-top: 940px; margin-left: 444px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Дополнительно</h1></div></div></div></foreignObject><text x="444" y="944" fill="#000000" font-family="Helvetica" font-size="12px">Дополнительно</text></switch></g><rect x="441" y="970" width="359" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 351px; height: 1px; padding-top: 960px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 100px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h2>StepOverrider</h2><p>Переопределяет шаг согласно какой-то логике.<br />DefaultStepOverrider – д<span>ефолтная реализация, не изменяющая шаг.</span></p></div></div></div></foreignObject><text x="446" y="972" fill="#000000" font-family="Helvetica" font-size="12px">StepOverrider...</text></switch></g><rect x="441" y="1070" width="359" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 351px; height: 1px; padding-top: 1060px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 100px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h2>RecordingStepNavigator</h2><p>Реализация StepNavigator-а, полезная для тестов.<br />Принимает функцию маппинга State в StateResult, возвращает список пройденных шагов флоу.</p></div></div></div></foreignObject><text x="446" y="1072" fill="#000000" font-family="Helvetica" font-size="12px">RecordingStepNavigator...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>