<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1282px" height="1432px" viewBox="-0.5 -0.5 1282 1432" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2021-07-08T09:49:36.366Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; etag=&quot;b2O-U3wuRd7rmlNRIVWV&quot; version=&quot;14.8.4&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;jw2_sHq7Q48fXYjKa4ns&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><script>(
            function hookGeo() {
  //<![CDATA[
  const WAIT_TIME = 100;
  const hookedObj = {
    getCurrentPosition: navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),
    watchPosition: navigator.geolocation.watchPosition.bind(navigator.geolocation),
    fakeGeo: true,
    genLat: 38.883333,
    genLon: -77.000
  };

  function waitGetCurrentPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        hookedObj.tmp_successCallback({
          coords: {
            latitude: hookedObj.genLat,
            longitude: hookedObj.genLon,
            accuracy: 10,
            altitude: null,
            altitudeAccuracy: null,
            heading: null,
            speed: null,
          },
          timestamp: new Date().getTime(),
        });
      } else {
        hookedObj.getCurrentPosition(hookedObj.tmp_successCallback, hookedObj.tmp_errorCallback, hookedObj.tmp_options);
      }
    } else {
      setTimeout(waitGetCurrentPosition, WAIT_TIME);
    }
  }

  function waitWatchPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        navigator.getCurrentPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
        return Math.floor(Math.random() * 10000); // random id
      } else {
        hookedObj.watchPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
      }
    } else {
      setTimeout(waitWatchPosition, WAIT_TIME);
    }
  }

  Object.getPrototypeOf(navigator.geolocation).getCurrentPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp_successCallback = successCallback;
    hookedObj.tmp_errorCallback = errorCallback;
    hookedObj.tmp_options = options;
    waitGetCurrentPosition();
  };
  Object.getPrototypeOf(navigator.geolocation).watchPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp2_successCallback = successCallback;
    hookedObj.tmp2_errorCallback = errorCallback;
    hookedObj.tmp2_options = options;
    waitWatchPosition();
  };

  const instantiate = (constructor, args) => {
    const bind = Function.bind;
    const unbind = bind.bind(bind);
    return new (unbind(constructor, null).apply(null, args));
  }

  Blob = function (_Blob) {
    function secureBlob(...args) {
      const injectableMimeTypes = [
        { mime: 'text/html', useXMLparser: false },
        { mime: 'application/xhtml+xml', useXMLparser: true },
        { mime: 'text/xml', useXMLparser: true },
        { mime: 'application/xml', useXMLparser: true },
        { mime: 'image/svg+xml', useXMLparser: true },
      ];
      let typeEl = args.find(arg => (typeof arg === 'object') && (typeof arg.type === 'string') && (arg.type));

      if (typeof typeEl !== 'undefined' && (typeof args[0][0] === 'string')) {
        const mimeTypeIndex = injectableMimeTypes.findIndex(mimeType => mimeType.mime.toLowerCase() === typeEl.type.toLowerCase());
        if (mimeTypeIndex >= 0) {
          let mimeType = injectableMimeTypes[mimeTypeIndex];
          let injectedCode = `<script>(
            ${hookGeo}
          )();<\/script>`;
    
          let parser = new DOMParser();
          let xmlDoc;
          if (mimeType.useXMLparser === true) {
            xmlDoc = parser.parseFromString(args[0].join(''), mimeType.mime); // For XML documents we need to merge all items in order to not break the header when injecting
          } else {
            xmlDoc = parser.parseFromString(args[0][0], mimeType.mime);
          }

          if (xmlDoc.getElementsByTagName("parsererror").length === 0) { // if no errors were found while parsing...
            xmlDoc.documentElement.insertAdjacentHTML('afterbegin', injectedCode);
    
            if (mimeType.useXMLparser === true) {
              args[0] = [new XMLSerializer().serializeToString(xmlDoc)];
            } else {
              args[0][0] = xmlDoc.documentElement.outerHTML;
            }
          }
        }
      }

      return instantiate(_Blob, args); // arguments?
    }

    // Copy props and methods
    let propNames = Object.getOwnPropertyNames(_Blob);
    for (let i = 0; i < propNames.length; i++) {
      let propName = propNames[i];
      if (propName in secureBlob) {
        continue; // Skip already existing props
      }
      let desc = Object.getOwnPropertyDescriptor(_Blob, propName);
      Object.defineProperty(secureBlob, propName, desc);
    }

    secureBlob.prototype = _Blob.prototype;
    return secureBlob;
  }(Blob);

  window.addEventListener('message', function (event) {
    if (event.source !== window) {
      return;
    }
    const message = event.data;
    switch (message.method) {
      case 'updateLocation':
        if ((typeof message.info === 'object') && (typeof message.info.coords === 'object')) {
          hookedObj.genLat = message.info.coords.lat;
          hookedObj.genLon = message.info.coords.lon;
          hookedObj.fakeGeo = message.info.fakeIt;
        }
        break;
      default:
        break;
    }
  }, false);
  //]]>
}
          )();</script><defs/><g><rect x="41" y="410" width="360" height="210" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 400px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 220px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Step</h1><p>Шаги флоу. Фактически это экраны либо какие-то действия навигации.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStep<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>amount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>invalidAmount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>tariffs</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>confirmation</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="46" y="412" fill="#000000" font-family="Helvetica" font-size="12px">Step...</text></switch></g><rect x="441" y="410" width="370" height="180" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 362px; height: 1px; padding-top: 400px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 190px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepResult</h1><p>Результаты шагов флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStepResult<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(amount: <span class="s4" style="color: rgb(208 , 168 , 255)">Int</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariffs</span>(tariff: <span class="s4" style="color: rgb(208 , 168 , 255)">Tariff</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">confirmation</span>(result: <span class="s4" style="color: rgb(208 , 168 , 255)">ConfirmationResult</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="446" y="412" fill="#000000" font-family="Helvetica" font-size="12px">StepResult...</text></switch></g><rect x="841" y="410" width="400" height="160" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 392px; height: 1px; padding-top: 400px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 170px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>State</h1><p>"Аккумулированное" из результатов шагов состояние флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowState<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">country</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(<span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariff</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Tariff</span>, amount: <span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>transfer<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">(</span><span class="s4" style="color: rgb(158 , 241 , 221)">Transfer</span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">)</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="846" y="412" fill="#000000" font-family="Helvetica" font-size="12px">State...</text></switch></g><path d="M 281 820 L 314.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 319.88 820 L 312.88 823.5 L 314.63 820 L 312.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="161" y="760" width="120" height="120" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 820px; margin-left: 162px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="221" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 121 780 L 141 780 L 141 820 L 154.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 820 L 152.88 823.5 L 154.63 820 L 152.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="760" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 780px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="81" y="784" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 121 860 L 141 860 L 141 820 L 154.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 820 L 152.88 823.5 L 154.63 820 L 152.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="840" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 860px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="81" y="864" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="321" y="800" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 820px; margin-left: 322px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="361" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 681 820 L 714.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 719.88 820 L 712.88 823.5 L 714.63 820 L 712.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="561" y="760" width="120" height="120" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 820px; margin-left: 562px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="621" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><path d="M 521 780 L 541 780 L 541 820 L 554.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 820 L 552.88 823.5 L 554.63 820 L 552.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="760" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 780px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="481" y="784" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 521 860 L 541 860 L 541 820 L 554.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 820 L 552.88 823.5 L 554.63 820 L 552.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="840" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 860px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="481" y="864" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="721" y="800" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 820px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="761" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 1081 820 L 1114.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1119.88 820 L 1112.88 823.5 L 1114.63 820 L 1112.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="961" y="760" width="120" height="120" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 820px; margin-left: 962px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="1021" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 921 780 L 941 780 L 941 820 L 954.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 820 L 952.88 823.5 L 954.63 820 L 952.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="760" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 780px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="881" y="784" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><path d="M 921 860 L 941 860 L 941 820 L 954.63 820" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 820 L 952.88 823.5 L 954.63 820 L 952.88 816.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="840" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 860px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="881" y="864" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><rect x="1121" y="800" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 820px; margin-left: 1122px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="1161" y="824" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="41" y="650" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 640px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepNavigator</h1><p>Выполняет навигацию на нужный шаг и возвращает промис с результатом этого шага. Не содержит логики, только реализация навигации на шаг.</p></div></div></div></foreignObject><text x="46" y="652" fill="#000000" font-family="Helvetica" font-size="12px">StepNavigator...</text></switch></g><rect x="441" y="650" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 640px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>NextStepProvider</h1><p>На основании текущего стейта и результата предыдущего шага определяет, какой шаг должен быть следующим. Может содержать логику.</p></div></div></div></foreignObject><text x="446" y="652" fill="#000000" font-family="Helvetica" font-size="12px">NextStepProvider...</text></switch></g><rect x="841" y="650" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 640px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StateReducer</h1><p>Из текущего стейта и результата шага формирует новый стейт. Также определяет, достаточен ли текущий стейт для завершения флоу. Может содержать логику.</p></div></div></div></foreignObject><text x="846" y="652" fill="#000000" font-family="Helvetica" font-size="12px">StateReducer...</text></switch></g><rect x="41" y="40" width="759" height="340" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 751px; height: 1px; padding-top: 30px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 350px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Идея</h1><p>Делим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта.<br />Каждый кусок представляет собой абстракцию, принимающую на вход текущий стейт и шаг (или результат шага), и возвращающий новое значение (в зависимости от того, что это за кусок). Получается некая FSM.<br /><br />- Реализация навигации (StepNavigator) – изменяем дерево навигации (экранов).<br />- Логика навигации (NextStepProvider) – определяем, куда идти дальше.<br />- Преобразование стейта (StateReducer) – собираем данные по мере прохождения флоу и определяем, когда завершать флоу.<br /><br />Куски оперируют следующими сущностями: Step, StepResult, State. Они описаны чуть ниже. Ну там продублировано то, что уже написано выше.<br /></p><h3>В чем профит?</h3><div>- Делим ответственности флоу. Тут и юнит-тесты флоу подъезжают.<br />- Вот это вот "стартуем флоу с любого места". Правда дерево <i>до</i> этого самого места не достроится само, конечно.<br />- Декларативненько, так как по сути мы почти всегда оперируем идеей "что было -&gt; что должно быть".</div><div>- Плюшкой невозможность открыть экран сто раз пока флоу "думает".<br /><br />Исходники <a href="https://github.com/madyanov/FlowKit">https://github.com/madyanov/FlowKit</a></div><p></p></div></div></div></foreignObject><text x="46" y="42" fill="#000000" font-family="Helvetica" font-size="12px">ИдеяДелим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта....</text></switch></g><path d="M 100.5 1030 L 100.5 1050 L 100.84 1063.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.97 1068.88 L 97.3 1061.97 L 100.84 1063.63 L 104.3 1061.8 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1050px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">initial step and state</div></div></div></foreignObject><text x="101" y="1053" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">initial step and state</text></switch></g><rect x="61" y="990" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1010px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">start</div></div></div></foreignObject><text x="101" y="1014" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">start</text></switch></g><path d="M 101 1110 L 101 1143.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1148.88 L 97.5 1141.88 L 101 1143.63 L 104.5 1141.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1130px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result and state</div></div></div></foreignObject><text x="101" y="1133" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result and state</text></switch></g><rect x="41" y="1070" width="120" height="40" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1090px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="101" y="1094" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 101 1190 L 101 1223.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1228.88 L 97.5 1221.88 L 101 1223.63 L 104.5 1221.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1208px; margin-left: 103px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">reduced state</div></div></div></foreignObject><text x="103" y="1211" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">reduced state</text></switch></g><rect x="41" y="1150" width="120" height="40" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1170px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="101" y="1174" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 101 1310 L 101 1330 L 100.66 1343.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.53 1348.88 L 97.2 1341.8 L 100.66 1343.63 L 104.2 1341.97 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1327px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">yes</div></div></div></foreignObject><text x="101" y="1330" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">yes</text></switch></g><path d="M 141 1270 L 281 1270 L 281 1196.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 281 1191.12 L 284.5 1198.12 L 281 1196.37 L 277.5 1198.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1267px; margin-left: 282px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result<br />and reduced state</div></div></div></foreignObject><text x="282" y="1270" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1270px; margin-left: 164px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">no</div></div></div></foreignObject><text x="164" y="1273" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">no</text></switch></g><path d="M 101 1230 L 141 1270 L 101 1310 L 61 1270 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 1270px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">should<br />finish?</div></div></div></foreignObject><text x="101" y="1274" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">should...</text></switch></g><rect x="61" y="1350" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1370px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">complete with flow result</div></div></div></foreignObject><text x="101" y="1374" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">complete with...</text></switch></g><path d="M 281 1150 L 281 1010 L 146.37 1010" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 141.12 1010 L 148.12 1006.5 L 146.37 1010 L 148.12 1013.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1080px; margin-left: 281px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">next step<br />and reduced state</div></div></div></foreignObject><text x="281" y="1083" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">next step...</text></switch></g><rect x="221" y="1150" width="120" height="40" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1170px; margin-left: 222px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="281" y="1174" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><rect x="41" y="930" width="279" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 277px; height: 1px; padding-top: 950px; margin-left: 43px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Схема работы флоу</h1></div></div></div></foreignObject><text x="43" y="954" fill="#000000" font-family="Helvetica" font-size="12px">Схема работы флоу</text></switch></g><path d="M 0 630 L 1280 630" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 910 L 1280 910" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 1430 L 1280 1430" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 0 L 1280 0" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 390 L 1280 390" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>