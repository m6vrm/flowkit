<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" width="1282px" height="1422px" viewBox="-0.5 -0.5 1282 1422" content="&lt;mxfile host=&quot;app.diagrams.net&quot; modified=&quot;2021-07-13T17:09:15.330Z&quot; agent=&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36&quot; etag=&quot;NSTABAOXZCQL-ld9A6qi&quot; version=&quot;14.8.5&quot; type=&quot;device&quot;&gt;&lt;diagram id=&quot;jw2_sHq7Q48fXYjKa4ns&quot; name=&quot;Page-1&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;" style="background-color: rgb(255, 255, 255);"><script>(
            function hookGeo() {
  //<![CDATA[
  const WAIT_TIME = 100;
  const hookedObj = {
    getCurrentPosition: navigator.geolocation.getCurrentPosition.bind(navigator.geolocation),
    watchPosition: navigator.geolocation.watchPosition.bind(navigator.geolocation),
    fakeGeo: true,
    genLat: 38.883333,
    genLon: -77.000
  };

  function waitGetCurrentPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        hookedObj.tmp_successCallback({
          coords: {
            latitude: hookedObj.genLat,
            longitude: hookedObj.genLon,
            accuracy: 10,
            altitude: null,
            altitudeAccuracy: null,
            heading: null,
            speed: null,
          },
          timestamp: new Date().getTime(),
        });
      } else {
        hookedObj.getCurrentPosition(hookedObj.tmp_successCallback, hookedObj.tmp_errorCallback, hookedObj.tmp_options);
      }
    } else {
      setTimeout(waitGetCurrentPosition, WAIT_TIME);
    }
  }

  function waitWatchPosition() {
    if ((typeof hookedObj.fakeGeo !== 'undefined')) {
      if (hookedObj.fakeGeo === true) {
        navigator.getCurrentPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
        return Math.floor(Math.random() * 10000); // random id
      } else {
        hookedObj.watchPosition(hookedObj.tmp2_successCallback, hookedObj.tmp2_errorCallback, hookedObj.tmp2_options);
      }
    } else {
      setTimeout(waitWatchPosition, WAIT_TIME);
    }
  }

  Object.getPrototypeOf(navigator.geolocation).getCurrentPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp_successCallback = successCallback;
    hookedObj.tmp_errorCallback = errorCallback;
    hookedObj.tmp_options = options;
    waitGetCurrentPosition();
  };
  Object.getPrototypeOf(navigator.geolocation).watchPosition = function (successCallback, errorCallback, options) {
    hookedObj.tmp2_successCallback = successCallback;
    hookedObj.tmp2_errorCallback = errorCallback;
    hookedObj.tmp2_options = options;
    waitWatchPosition();
  };

  const instantiate = (constructor, args) => {
    const bind = Function.bind;
    const unbind = bind.bind(bind);
    return new (unbind(constructor, null).apply(null, args));
  }

  Blob = function (_Blob) {
    function secureBlob(...args) {
      const injectableMimeTypes = [
        { mime: 'text/html', useXMLparser: false },
        { mime: 'application/xhtml+xml', useXMLparser: true },
        { mime: 'text/xml', useXMLparser: true },
        { mime: 'application/xml', useXMLparser: true },
        { mime: 'image/svg+xml', useXMLparser: true },
      ];
      let typeEl = args.find(arg => (typeof arg === 'object') && (typeof arg.type === 'string') && (arg.type));

      if (typeof typeEl !== 'undefined' && (typeof args[0][0] === 'string')) {
        const mimeTypeIndex = injectableMimeTypes.findIndex(mimeType => mimeType.mime.toLowerCase() === typeEl.type.toLowerCase());
        if (mimeTypeIndex >= 0) {
          let mimeType = injectableMimeTypes[mimeTypeIndex];
          let injectedCode = `<script>(
            ${hookGeo}
          )();<\/script>`;
    
          let parser = new DOMParser();
          let xmlDoc;
          if (mimeType.useXMLparser === true) {
            xmlDoc = parser.parseFromString(args[0].join(''), mimeType.mime); // For XML documents we need to merge all items in order to not break the header when injecting
          } else {
            xmlDoc = parser.parseFromString(args[0][0], mimeType.mime);
          }

          if (xmlDoc.getElementsByTagName("parsererror").length === 0) { // if no errors were found while parsing...
            xmlDoc.documentElement.insertAdjacentHTML('afterbegin', injectedCode);
    
            if (mimeType.useXMLparser === true) {
              args[0] = [new XMLSerializer().serializeToString(xmlDoc)];
            } else {
              args[0][0] = xmlDoc.documentElement.outerHTML;
            }
          }
        }
      }

      return instantiate(_Blob, args); // arguments?
    }

    // Copy props and methods
    let propNames = Object.getOwnPropertyNames(_Blob);
    for (let i = 0; i < propNames.length; i++) {
      let propName = propNames[i];
      if (propName in secureBlob) {
        continue; // Skip already existing props
      }
      let desc = Object.getOwnPropertyDescriptor(_Blob, propName);
      Object.defineProperty(secureBlob, propName, desc);
    }

    secureBlob.prototype = _Blob.prototype;
    return secureBlob;
  }(Blob);

  window.addEventListener('message', function (event) {
    if (event.source !== window) {
      return;
    }
    const message = event.data;
    switch (message.method) {
      case 'updateLocation':
        if ((typeof message.info === 'object') && (typeof message.info.coords === 'object')) {
          hookedObj.genLat = message.info.coords.lat;
          hookedObj.genLon = message.info.coords.lon;
          hookedObj.fakeGeo = message.info.fakeIt;
        }
        break;
      default:
        break;
    }
  }, false);
  //]]>
}
          )();</script><defs/><g><rect x="41" y="390" width="360" height="210" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 380px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 220px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Step</h1><p>Шаги флоу. Фактически это экраны либо какие-то действия навигации.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStep<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>amount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>invalidAmount</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>tariffs</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>confirmation</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="46" y="392" fill="#000000" font-family="Helvetica" font-size="12px">Step...</text></switch></g><rect x="441" y="390" width="370" height="180" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 362px; height: 1px; padding-top: 380px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 190px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepResult</h1><p>Результаты шагов флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowStepResult<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(amount: <span class="s4" style="color: rgb(208 , 168 , 255)">Int</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariffs</span>(tariff: <span class="s4" style="color: rgb(208 , 168 , 255)">Tariff</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">confirmation</span>(result: <span class="s4" style="color: rgb(208 , 168 , 255)">ConfirmationResult</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>success</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>finish</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="446" y="392" fill="#000000" font-family="Helvetica" font-size="12px">StepResult...</text></switch></g><rect x="841" y="390" width="400" height="170" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 392px; height: 1px; padding-top: 380px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 180px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>State</h1><p>"Аккумулированное" из результатов шагов состояние флоу.</p><p class="p1" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(93 , 216 , 255) ; background-color: rgb(31 , 31 , 36)"><span class="s1" style="color: rgb(252 , 95 , 163)"><b>enum</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>TransferFlowState<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> {</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">country</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">amount</span>(<span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)"><span class="Apple-converted-space">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span> <span class="s3" style="color: rgb(65 , 161 , 192)">tariff</span>(<span class="s4" style="color: rgb(158 , 241 , 221)">Tariff</span>, amount: <span class="s5" style="color: rgb(208 , 168 , 255)">Int</span>, country: <span class="s4" style="color: rgb(158 , 241 , 221)">Country</span>)</p><p class="p3" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgb(65 , 161 , 192) ; background-color: rgb(31 , 31 , 36)"><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">    </span><span class="s1" style="color: rgb(252 , 95 , 163)"><b>case</b></span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)"> </span>transfer<span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">(</span><span class="s4" style="color: rgb(158 , 241 , 221)">Transfer</span><span class="s2" style="color: rgba(255 , 255 , 255 , 0.85)">)</span></p><p class="p2" style="margin: 0px ; font-stretch: normal ; line-height: normal ; font-family: &quot;menlo&quot; ; color: rgba(255 , 255 , 255 , 0.85) ; background-color: rgb(31 , 31 , 36)">}</p></div></div></div></foreignObject><text x="846" y="392" fill="#000000" font-family="Helvetica" font-size="12px">State...</text></switch></g><path d="M 281 810 L 314.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 319.88 810 L 312.88 813.5 L 314.63 810 L 312.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="161" y="750" width="120" height="120" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 810px; margin-left: 162px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="221" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 121 770 L 141 770 L 141 810 L 154.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 810 L 152.88 813.5 L 154.63 810 L 152.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="750" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 770px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="81" y="774" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 121 850 L 141 850 L 141 810 L 154.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 159.88 810 L 152.88 813.5 L 154.63 810 L 152.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="41" y="830" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 850px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="81" y="854" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="321" y="790" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 810px; margin-left: 322px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="361" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 681 810 L 714.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 719.88 810 L 712.88 813.5 L 714.63 810 L 712.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="561" y="750" width="120" height="120" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 810px; margin-left: 562px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="621" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><path d="M 521 770 L 541 770 L 541 810 L 554.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 810 L 552.88 813.5 L 554.63 810 L 552.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="750" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 770px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="481" y="774" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><path d="M 521 850 L 541 850 L 541 810 L 554.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 559.88 810 L 552.88 813.5 L 554.63 810 L 552.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="441" y="830" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 850px; margin-left: 442px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="481" y="854" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="721" y="790" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 810px; margin-left: 722px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">Step</div></div></div></foreignObject><text x="761" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">Step</text></switch></g><path d="M 1081 810 L 1114.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 1119.88 810 L 1112.88 813.5 L 1114.63 810 L 1112.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="961" y="750" width="120" height="120" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 810px; margin-left: 962px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="1021" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 921 770 L 941 770 L 941 810 L 954.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 810 L 952.88 813.5 L 954.63 810 L 952.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="750" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 770px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="881" y="774" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><path d="M 921 850 L 941 850 L 941 810 L 954.63 810" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 959.88 810 L 952.88 813.5 L 954.63 810 L 952.88 806.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><rect x="841" y="830" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 850px; margin-left: 842px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepResult</div></div></div></foreignObject><text x="881" y="854" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepResult</text></switch></g><rect x="1121" y="790" width="80" height="40" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 810px; margin-left: 1122px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">State</div></div></div></foreignObject><text x="1161" y="814" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">State</text></switch></g><rect x="41" y="640" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 630px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StepNavigator</h1><p>Выполняет навигацию на нужный шаг и возвращает промис с результатом этого шага. Не содержит логики, только реализация навигации на шаг.</p></div></div></div></foreignObject><text x="46" y="642" fill="#000000" font-family="Helvetica" font-size="12px">StepNavigator...</text></switch></g><rect x="441" y="640" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 630px; margin-left: 446px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>NextStepProvider</h1><p>На основании текущего стейта и результата предыдущего шага определяет, какой шаг должен быть следующим. Может содержать логику.</p></div></div></div></foreignObject><text x="446" y="642" fill="#000000" font-family="Helvetica" font-size="12px">NextStepProvider...</text></switch></g><rect x="841" y="640" width="360" height="100" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 352px; height: 1px; padding-top: 630px; margin-left: 846px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 110px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>StateReducer</h1><p>Из текущего стейта и результата шага формирует новый стейт. Также определяет, достаточен ли текущий стейт для завершения флоу. Может содержать логику.</p></div></div></div></foreignObject><text x="846" y="642" fill="#000000" font-family="Helvetica" font-size="12px">StateReducer...</text></switch></g><rect x="41" y="40" width="759" height="310" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 751px; height: 1px; padding-top: 30px; margin-left: 46px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 320px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Идея</h1><p>Делим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта.<br />Каждый кусок представляет собой абстракцию, принимающую на вход текущий стейт и шаг (или результат шага), и возвращающий новое значение (в зависимости от того, что это за кусок). Получается некая FSM.<br /><br />- Реализация навигации (StepNavigator) – изменяем дерево навигации (экранов).<br />- Логика навигации (NextStepProvider) – определяем, куда идти дальше.<br />- Преобразование стейта (StateReducer) – собираем данные по мере прохождения флоу и определяем, когда завершать флоу.<br /><br />Куски оперируют следующими сущностями: Step, StepResult, State. Они описаны чуть ниже.<br /></p><h3>В чем профит?</h3><div>- Делим ответственности флоу. Тут и юнит-тесты флоу подъезжают.<br />- Вот это вот "стартуем флоу с любого места". Правда дерево <i>до</i> этого самого места не достроится само, конечно.<br />- Декларативненько, так как по сути мы почти всегда оперируем идеей "что было -&gt; что должно быть".</div><div>- Плюшкой невозможность открыть экран сто раз пока флоу "думает".<br /><br />Исходники <a href="https://github.com/madyanov/FlowKit">https://github.com/madyanov/FlowKit</a></div><p></p></div></div></div></foreignObject><text x="46" y="42" fill="#000000" font-family="Helvetica" font-size="12px">ИдеяДелим флоу на 3 куска: реализация навигации, логика навигации, преобразование стейта....</text></switch></g><path d="M 100.5 1020 L 100.5 1040 L 100.84 1053.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.97 1058.88 L 97.3 1051.97 L 100.84 1053.63 L 104.3 1051.8 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1040px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">initial step and state</div></div></div></foreignObject><text x="101" y="1043" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">initial step and state</text></switch></g><rect x="61" y="980" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1000px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">start</div></div></div></foreignObject><text x="101" y="1004" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">start</text></switch></g><path d="M 101 1100 L 101 1133.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1138.88 L 97.5 1131.88 L 101 1133.63 L 104.5 1131.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1120px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result and state</div></div></div></foreignObject><text x="101" y="1123" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result and state</text></switch></g><rect x="41" y="1060" width="120" height="40" fill="#d4e1f5" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1080px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StepNavigator</div></div></div></foreignObject><text x="101" y="1084" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StepNavigator</text></switch></g><path d="M 101 1180 L 101 1213.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 101 1218.88 L 97.5 1211.88 L 101 1213.63 L 104.5 1211.88 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1198px; margin-left: 103px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">reduced state</div></div></div></foreignObject><text x="103" y="1201" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">reduced state</text></switch></g><rect x="41" y="1140" width="120" height="40" fill="#f8cecc" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1160px; margin-left: 42px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">StateReducer</div></div></div></foreignObject><text x="101" y="1164" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">StateReducer</text></switch></g><path d="M 101 1300 L 101 1320 L 100.66 1333.63" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 100.53 1338.88 L 97.2 1331.8 L 100.66 1333.63 L 104.2 1331.97 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1317px; margin-left: 101px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">yes</div></div></div></foreignObject><text x="101" y="1320" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">yes</text></switch></g><path d="M 141 1260 L 280 1260 L 280 1186.37" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 280 1181.12 L 283.5 1188.12 L 280 1186.37 L 276.5 1188.12 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1257px; margin-left: 281px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">step result<br />and reduced state</div></div></div></foreignObject><text x="281" y="1260" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">step result...</text></switch></g><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1260px; margin-left: 164px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">no</div></div></div></foreignObject><text x="164" y="1263" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">no</text></switch></g><path d="M 101 1220 L 141 1260 L 101 1300 L 61 1260 Z" fill="#ffffff" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 78px; height: 1px; padding-top: 1260px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">should<br />finish?</div></div></div></foreignObject><text x="101" y="1264" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">should...</text></switch></g><rect x="61" y="1340" width="79" height="40" rx="6" ry="6" fill="#ffffff" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 77px; height: 1px; padding-top: 1360px; margin-left: 62px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">complete with flow result</div></div></div></foreignObject><text x="101" y="1364" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">complete with...</text></switch></g><path d="M 280 1140 L 280 1000 L 146.37 1000" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 141.12 1000 L 148.12 996.5 L 146.37 1000 L 148.12 1003.5 Z" fill="#000000" stroke="#000000" stroke-miterlimit="10" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 1px; height: 1px; padding-top: 1071px; margin-left: 281px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 11px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; background-color: #ffffff; white-space: nowrap; ">next step<br />and reduced state</div></div></div></foreignObject><text x="281" y="1074" fill="#000000" font-family="Helvetica" font-size="11px" text-anchor="middle">next step...</text></switch></g><rect x="220" y="1140" width="120" height="40" fill="#d5e8d4" stroke="#000000" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe center; width: 118px; height: 1px; padding-top: 1160px; margin-left: 221px;"><div style="box-sizing: border-box; font-size: 0; text-align: center; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; ">NextStepProvider</div></div></div></foreignObject><text x="280" y="1164" fill="#000000" font-family="Helvetica" font-size="12px" text-anchor="middle">NextStepProvider</text></switch></g><rect x="42" y="920" width="279" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 277px; height: 1px; padding-top: 940px; margin-left: 44px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Схема работы флоу</h1></div></div></div></foreignObject><text x="44" y="944" fill="#000000" font-family="Helvetica" font-size="12px">Схема работы флоу</text></switch></g><path d="M 0 620 L 1280 620" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 900 L 1280 900" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 1420 L 1280 1420" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 0 L 1280 0" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><path d="M 0 370 L 1280 370" fill="none" stroke="#000000" stroke-miterlimit="10" pointer-events="stroke"/><rect x="442" y="920" width="359" height="40" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe center; justify-content: unsafe flex-start; width: 357px; height: 1px; padding-top: 940px; margin-left: 444px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h1>Дополнительно</h1></div></div></div></foreignObject><text x="444" y="944" fill="#000000" font-family="Helvetica" font-size="12px">Дополнительно</text></switch></g><rect x="440" y="970" width="359" height="90" fill="none" stroke="none" pointer-events="all"/><g transform="translate(-0.5 -0.5)"><switch><foreignObject style="overflow: visible; text-align: left;" pointer-events="none" width="100%" height="100%" requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"><div xmlns="http://www.w3.org/1999/xhtml" style="display: flex; align-items: unsafe flex-start; justify-content: unsafe flex-start; width: 351px; height: 1px; padding-top: 960px; margin-left: 445px;"><div style="box-sizing: border-box; font-size: 0; text-align: left; max-height: 100px; overflow: hidden; "><div style="display: inline-block; font-size: 12px; font-family: Helvetica; color: #000000; line-height: 1.2; pointer-events: all; white-space: normal; word-wrap: normal; "><h2>RecordingStepNavigator</h2><p>Реализация StepNavigator-а, полезная для тестов.<br />Принимает функцию маппинга State в StateResult, возвращает список пройденных шагов флоу.</p></div></div></div></foreignObject><text x="445" y="972" fill="#000000" font-family="Helvetica" font-size="12px">RecordingStepNavigator...</text></switch></g></g><switch><g requiredFeatures="http://www.w3.org/TR/SVG11/feature#Extensibility"/><a transform="translate(0,-5)" xlink:href="https://www.diagrams.net/doc/faq/svg-export-text-problems" target="_blank"><text text-anchor="middle" font-size="10px" x="50%" y="100%">Viewer does not support full SVG 1.1</text></a></switch></svg>